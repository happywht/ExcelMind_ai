import{l as a}from"./index-qAfVvIMr.js";const g=()=>{const e=window.__ELECTRON_ENV__;return e&&e.IS_ELECTRON?(console.log("[aiProxyService] 检测到 Electron 环境，使用:",e.API_BASE_URL),e.API_BASE_URL):"/api"},i=g();console.log("[aiProxyService] API_BASE_URL 已设置为:",i);const _=()=>{let e=localStorage.getItem("excelmind_client_id");return e||(e=`client_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,localStorage.setItem("excelmind_client_id",e)),e},s=()=>localStorage.getItem("auth_token")||sessionStorage.getItem("auth_token"),l=async(e,r)=>{var t;const n=`${i}/v2/ai${e}`;try{const o=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json","X-Client-ID":_(),...s()&&{Authorization:`Bearer ${s()}`}},body:JSON.stringify(r)});if(!o.ok){const u=await o.text();throw new Error(`API调用失败 (${o.status}): ${u||o.statusText}`)}const c=await o.json();if(!c.success)throw new Error(((t=c.error)==null?void 0:t.message)||"AI调用失败");return c.data}catch(o){throw a.error(`[aiProxyService] API请求失败: ${e}`,o),o}},x=async e=>{try{a.debug("[aiProxyService] 调用后端AI服务生成Excel公式");const r=await l("/generate-formula",{description:e});return a.debug("[aiProxyService] Excel公式生成成功:",r.formula),r.formula}catch(r){throw a.error("[aiProxyService] Excel公式生成失败:",r),r}},h=async(e,r,n)=>{try{a.debug("[aiProxyService] 调用后端AI服务进行知识库对话");const t=await l("/chat",{query:e,history:r,contextDocs:n||""});return a.debug("[aiProxyService] 知识库对话成功"),t.response}catch(t){return a.error("[aiProxyService] 知识库对话失败:",t),`抱歉,${t instanceof Error?t.message:"连接AI服务失败,请稍后重试"}`}};export{h as c,x as g};
