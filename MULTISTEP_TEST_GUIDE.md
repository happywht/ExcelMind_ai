# 多步分析系统 - 运行时测试指南

**测试日期**: 2025-01-22
**测试环境**: Electron + Vite 开发服务器
**系统版本**: 1.0.0 (Commit: d90aed0)

---

## 📋 测试准备

### 环境检查
- ✅ Vite 开发服务器 (端口 3000)
- ✅ Electron 应用已启动
- ✅ Python 执行环境就绪
- ✅ AI 服务配置完成

### 测试数据准备

准备以下测试文件：
1. **简单数据** (`test-simple.xlsx`)
   - 包含基本的销售数据
   - 用于测试基础功能

2. **复杂数据** (`test-complex.xlsx`)
   - 包含多个Sheet
   - 包含错误数据
   - 用于测试错误修复

3. **边界数据** (`test-edge.xlsx`)
   - 空值、缺失值
   - 数据类型不一致
   - 用于测试质量评估

---

## 🧪 测试用例

### 测试 1: 基础多步分析流程

**目的**: 验证 OTAE 循环正常工作

**步骤**:
1. 打开 ExcelMind AI 应用
2. 上传 `test-simple.xlsx`
3. 输入命令: "计算总销售额"
4. 确保选择了"智能模式"
5. 点击"执行转换"

**预期结果**:
- ✅ 显示进度条 (0-100%)
- ✅ OTAE 图标依次激活:
  - 👁️ 观察 (分析数据结构)
  - 🧠 思考 (AI 生成计划)
  - ⚡ 执行 (运行 Python 代码)
  - ✅ 评估 (质量检查)
- ✅ 显示质量评分 (完整性、准确性、一致性)
- ✅ 生成结果文件

**观察点**:
```
进度日志应显示:
[observing] 正在分析数据结构...
[thinking] AI 正在生成执行计划...
[acting] 正在执行数据转换...
[evaluating] 正在评估结果质量...
```

---

### 测试 2: 错误自动修复

**目的**: 验证自我修复机制

**步骤**:
1. 上传包含错误的数据文件
2. 输入命令: "过滤无效数据并计算平均值"
3. 观察错误处理流程

**预期结果**:
- ✅ 检测到错误 (如: 列名不匹配)
- ✅ 显示错误分类
- ✅ AI 生成修复代码
- ✅ 自动重试 (最多3次)
- ✅ 成功执行或降级到快速模式

**观察点**:
```
日志应显示:
[error] 错误类别: COLUMN_ERROR
[repairing] 正在生成修复代码...
[retrying] 第 1 次重试...
[success] 修复成功
```

---

### 测试 3: 质量评估系统

**目的**: 验证三维度质量评估

**步骤**:
1. 执行任意数据分析任务
2. 查看质量报告

**预期结果**:
- ✅ 显示完整性评分 (0-100%)
- ✅ 显示准确性评分 (0-100%)
- ✅ 显示一致性评分 (0-100%)
- ✅ 显示总体评分
- ✅ 提供改进建议

**质量报告示例**:
```
质量评估报告
━━━━━━━━━━━━━━━━━━━━━
完整性: 95%  ✅
准确性: 88%  ✅
一致性: 92%  ✅
━━━━━━━━━━━━━━━━━━━━━
总体评分: 91.7%

建议:
- 检查缺失值处理
- 验证计算公式
```

---

### 测试 4: 双模式切换

**目的**: 验证智能模式和快速模式

**步骤**:
1. **测试智能模式** (默认)
   - 执行复杂任务
   - 观察多步分析过程

2. **切换到快速模式**
   - 取消勾选"智能模式"
   - 执行相同任务
   - 对比执行时间

**预期结果**:
- ✅ 智能模式: 显示完整 OTAE 流程
- ✅ 快速模式: 直接生成并执行代码
- ✅ 快速模式执行时间更短
- ✅ 智能模式质量更高

**性能对比**:
```
智能模式: 15-30秒 (包含分析、修复、评估)
快速模式: 5-10秒 (直接执行)
```

---

### 测试 5: 自动降级机制

**目的**: 验证智能模式失败时的降级

**步骤**:
1. 故意构造一个智能模式会失败的场景
2. 观察是否自动切换到快速模式

**预期结果**:
- ✅ 智能模式失败后显示警告
- ✅ 自动切换到快速模式
- ✅ 快速模式成功执行
- ✅ 日志显示降级信息

---

### 测试 6: 进度监控

**目的**: 验证实时进度更新

**步骤**:
1. 执行一个较复杂的任务
2. 观察进度条和状态更新

**预期结果**:
- ✅ 进度百分比实时更新 (0% → 100%)
- ✅ 状态文本动态变化
- ✅ OTAE 图标依次高亮
- ✅ 日志实时滚动

---

## 🐛 常见问题排查

### 问题 1: Electron 无法启动

**症状**: 双击后无反应

**解决方案**:
```bash
# 检查进程
tasklist | findstr electron

# 如果有残留进程，结束它
taskkill /F /IM electron.exe
taskkill /F /IM node.exe

# 重新启动
npm run electron
```

### 问题 2: Python 执行失败

**症状**: 显示"Python执行错误"

**检查项**:
1. Python 是否安装: `python --version`
2. pandas 是否安装: `python -c "import pandas"`
3. 临时目录权限: `%TEMP%`

**解决方案**:
```bash
# 安装依赖
pip install pandas openpyxl
```

### 问题 3: AI 服务无响应

**症状**: 卡在"AI思考中..."

**检查项**:
1. 网络连接
2. API Key 配置
3. 请求频率限制

**解决方案**:
- 检查 `services/zhipuService.ts` 中的配置
- 确认 API Key 有效
- 等待一段时间后重试

### 问题 4: 质量评分异常

**症状**: 评分显示为 0 或 NaN

**解决方案**:
- 检查返回数据格式
- 查看控制台错误日志
- 确认 AI 返回了有效的质量报告

---

## 📊 测试记录模板

```markdown
## 测试执行记录

**测试人员**: ______
**测试时间**: ______
**应用版本**: 1.0.0

| 测试用例 | 状态 | 执行时间 | 备注 |
|---------|------|----------|------|
| 测试1: 基础多步分析 | ⬜ 通过 / ❌ 失败 | ___ 秒 | |
| 测试2: 错误自动修复 | ⬜ 通过 / ❌ 失败 | ___ 秒 | |
| 测试3: 质量评估系统 | ⬜ 通过 / ❌ 失败 | ___ 秒 | |
| 测试4: 双模式切换 | ⬜ 通过 / ❌ 失败 | ___ 秒 | |
| 测试5: 自动降级机制 | ⬜ 通过 / ❌ 失败 | ___ 秒 | |
| 测试6: 进度监控 | ⬜ 通过 / ❌ 失败 | ___ 秒 | |

### 问题描述
(记录测试中遇到的问题)

### 截图
(粘贴关键截图)

### 总体评价
- 功能完整性: ___/10
- 用户体验: ___/10
- 性能表现: ___/10
- 稳定性: ___/10
```

---

## 🎯 测试成功标准

### 必须通过 (P0)
- ✅ 基础多步分析流程正常工作
- ✅ 能够成功执行 Python 代码
- ✅ 进度实时显示
- ✅ 不发生崩溃或死循环

### 应该通过 (P1)
- ✅ 错误修复机制有效
- ✅ 质量评估合理
- ✅ 双模式切换正常
- ✅ 自动降级工作

### 最好通过 (P2)
- ✅ 日志清晰易读
- ✅ 性能可接受
- ✅ UI 响应流畅

---

## 📝 测试后检查清单

- [ ] 所有测试用例已执行
- [ ] 测试结果已记录
- [ ] 问题已文档化
- [ ] 截图已保存
- [ ] 控制台日志已导出
- [ ] 性能数据已收集

---

## 🚀 下一步

测试完成后，根据结果决定：

1. **全部通过** → 准备发布给用户
2. **部分失败** → 修复问题并重新测试
3. **需要优化** → 进入性能优化阶段

---

**准备就绪！请开始测试。** 🎉
