# 多Sheet支持功能 - 手动测试指南

**测试人员**: QA Engineer
**测试日期**: 2026-01-18
**预计耗时**: 30-45分钟

---

## 🎯 测试目标

验证ExcelMind AI的多Sheet支持功能，包括：
1. 多Sheet Excel文件的识别和显示
2. Sheet选择器的UI交互
3. AI智能映射生成（跨Sheet场景）
4. 文档生成包含跨Sheet数据

---

## 📋 前置条件

### 环境准备
- [x] 开发服务器运行在 http://localhost:3000
- [x] 测试文件已生成（`public/test-files/`）
- [x] 浏览器已打开（推荐Chrome）

### 测试文件位置
```
D:\家庭\青聪赋能\excelmind-ai\public\test-files\
```

---

## 🧪 测试用例

### 测试用例1: 员工+部门（2个Sheet）

**优先级**: P0 (关键)
**预计耗时**: 10分钟

#### 步骤1: 上传Excel文件
1. 打开浏览器，访问 http://localhost:3000
2. 点击"文档空间"按钮/菜单
3. 在数据文件上传区域，点击"选择文件"
4. 选择 `test-multisheet-employee.xlsx`
5. 等待文件处理完成

**预期结果**:
- ✅ 文件上传成功
- ✅ 显示文件名和基本信息
- ✅ 出现Sheet选择器

**截图**: 保存为 `manual-test-01-upload.png`

---

#### 步骤2: 验证Sheet选择器
观察Sheet选择器区域：

**主数据表区域**:
- [ ] 显示"主数据表"标题
- [ ] 下拉框默认选中"员工表"
- [ ] 显示统计信息：
  - 表名: 员工表
  - 数据行数: 8
  - 字段数: 5

**辅助数据表区域**:
- [ ] 显示"辅助数据表"标题
- [ ] 显示1个辅助表卡片："部门表"
- [ ] 卡片显示：
  - 名称: 部门表
  - 行数: 5 行
  - 列数: 3 列
  - 主要字段: 部门ID, 部门名称, 部门地址
- [ ] 卡片未选中状态（白色背景）
- [ ] 右上角有"全选"按钮

**截图**: 保存为 `manual-test-02-sheet-selector.png`

---

#### 步骤3: 启用辅助Sheet
1. 点击"部门表"卡片
2. 观察卡片状态变化

**预期结果**:
- ✅ 卡片背景变为蓝色（bg-blue-50）
- ✅ 边框变为蓝色（border-blue-300）
- ✅ 左上角checkbox显示勾选标记
- ✅ 底部出现提示："已启用 1 个辅助表"

**截图**: 保存为 `manual-test-03-enable-sheet.png`

---

#### 步骤4: 输入AI指令
1. 在AI指令输入框中输入：
   ```
   生成员工工牌，包含姓名、部门和职位信息
   ```
2. 观察输入框显示

**预期结果**:
- ✅ 指令正确显示在输入框中
- ✅ 输入框可正常编辑

**截图**: 保存为 `manual-test-04-ai-instruction.png`

---

#### 步骤5: 生成AI映射
1. 点击"生成映射"或"智能映射"按钮
2. 观察处理过程（注意右侧日志区域）

**预期结果**:
- ✅ 按钮显示加载状态
- ✅ 日志区域显示处理进度：
  - "正在分析Excel数据结构..."
  - "检测到多个工作表..."
  - "生成智能映射方案..."
- ✅ 5-15秒后完成
- ✅ 映射方案显示在"映射方案"标签页

**关键验证点**:
- [ ] 查看生成的映射是否包含跨Sheet查找
- [ ] 验证映射规则：
  - 姓名 → 员工表.姓名
  - 部门 → 员工表.部门ID → 部门表.部门ID (查找) → 部门表.部门名称
  - 职位 → 员工表.职位

**截图**: 保存为 `manual-test-05-ai-mapping.png`

---

#### 步骤6: 生成文档
1. 切换到"生成文档"标签页
2. 点击"生成文档"按钮
3. 观察文档生成过程

**预期结果**:
- ✅ 显示进度条或加载动画
- ✅ 日志显示："正在生成文档..."
- ✅ 10-20秒后完成
- ✅ 显示生成的文档列表（8个文档）

**截图**: 保存为 `manual-test-06-generate-docs.png`

---

#### 步骤7: 验证文档内容
1. 点击第一个生成的文档
2. 预览文档内容
3. 点击"下载"按钮下载文档
4. 用Word打开下载的文档

**预期结果**:
- ✅ 文档预览显示完整内容
- ✅ 下载的docx文件可以正常打开
- ✅ **关键验证**: 文档包含跨Sheet获取的"部门名称"
  - 例如：张三的工牌显示"部门：技术部"（从部门表获取）
- ✅ 包含所有字段：姓名、部门、职位

**数据验证对照表**:
| 姓名 | 部门ID | 预期部门名称 | 职位 |
|------|--------|------------|------|
| 张三 | D001 | 技术部 | 工程师 |
| 李四 | D002 | 设计部 | 设计师 |
| 王五 | D001 | 技术部 | 高级工程师 |

**截图**: 保存为 `manual-test-07-document-content.png`

---

### 测试用例2: 订单+产品+客户（3个Sheet）

**优先级**: P1 (重要)
**预计耗时**: 12分钟

#### 步骤1: 上传订单Excel
1. 刷新页面或重新进入文档空间
2. 上传 `test-multisheet-order.xlsx`

**预期结果**:
- ✅ 文件上传成功
- ✅ Sheet选择器显示

---

#### 步骤2: 验证三个Sheet
**主数据表**:
- [ ] 默认选中"订单表"
- [ ] 统计信息：8行 × 5列

**辅助数据表**:
- [ ] 显示2个辅助表卡片：
  - 产品表（6行 × 3列）
  - 客户表（6行 × 4列）
- [ ] 卡片都未选中

**截图**: 保存为 `manual-test-08-three-sheets.png`

---

#### 步骤3: 启用多个辅助Sheet
1. 点击"产品表"卡片
2. 点击"客户表"卡片
3. 或直接点击"全选"按钮

**预期结果**:
- ✅ 两个卡片都变为选中状态（蓝色背景）
- ✅ 底部提示："已启用 2 个辅助表"

**截图**: 保存为 `manual-test-09-enable-multiple.png`

---

#### 步骤4: 生成订单确认单
1. 输入AI指令：
   ```
   生成订单确认单，包含订单号、产品名称、客户信息和数量
   ```
2. 点击"生成映射"
3. 观察映射结果
4. 点击"生成文档"

**预期结果**:
- ✅ AI映射识别出需要跨Sheet查找：
  - 产品表查找产品名称
  - 客户表查找客户信息
- ✅ 成功生成8个订单确认单

**截图**: 保存为 `manual-test-10-order-docs.png`

---

#### 步骤5: 验证跨Sheet数据
下载并打开一个订单确认单文档

**预期内容**:
```
订单确认单

订单号：O001
产品名称：笔记本电脑  ← 从产品表跨Sheet获取
客户信息：腾讯科技    ← 从客户表跨Sheet获取
数量：2
```

**数据验证对照表**:
| 订单ID | 产品ID | 预期产品名 | 客户ID | 预期客户名 |
|--------|--------|----------|--------|----------|
| O001 | P001 | 笔记本电脑 | C001 | 腾讯科技 |
| O002 | P002 | 无线鼠标 | C002 | 阿里巴巴 |

**截图**: 保存为 `manual-test-11-cross-sheet-data.png`

---

### 测试用例3: 单Sheet文件（对照组）

**优先级**: P2 (一般)
**预计耗时**: 5分钟

#### 步骤1: 上传单Sheet文件
1. 上传 `test-single-sheet.xlsx`

**预期结果**:
- ✅ 文件上传成功
- ✅ **只显示主数据表区域**
- ✅ **不显示辅助数据表区域**
- ✅ 显示提示："当前只有一个工作表，上传包含多个工作表的Excel文件可启用跨Sheet查找功能"

**截图**: 保存为 `manual-test-12-single-sheet.png`

---

### 测试用例4: UI交互测试

**优先级**: P2 (一般)
**预计耗时**: 8分钟

#### 测试4.1: 切换主Sheet
1. 上传 `test-multisheet-employee.xlsx`
2. 在主数据表下拉框中选择"部门表"

**预期结果**:
- ✅ 下拉框切换成功
- ✅ 主表统计信息更新为部门表的数据
- ✅ 辅助表区域现在显示"员工表"

**截图**: 保存为 `manual-test-13-switch-primary.png`

---

#### 测试4.2: 取消选中辅助Sheet
1. 点击已选中的辅助表卡片

**预期结果**:
- ✅ 卡片恢复为未选中状态（白色背景）
- ✅ Checkbox勾选消失
- ✅ 底部提示更新："已启用 0 个辅助表"或提示消失

**截图**: 保存为 `manual-test-14-uncheck-sheet.png`

---

#### 测试4.3: 全选/取消全选
1. 上传 `test-multisheet-order.xlsx`（3个Sheet）
2. 点击"全选"按钮

**预期结果**:
- ✅ 所有辅助表都被选中
- ✅ 按钮文字变为"取消全选"

3. 再次点击"取消全选"

**预期结果**:
- ✅ 所有辅助表取消选中
- ✅ 按钮文字变为"全选"

**截图**: 保存为 `manual-test-15-toggle-all.png`

---

## 🐛 缺陷报告

### 缺陷模板
如发现任何问题，请记录：

```
缺陷ID: BUG-001
标题: [简短描述]
严重性: [P0/P1/P2/P3]
优先级: [高/中/低]
步骤:
1. ...
2. ...
3. ...

预期结果: ...

实际结果: ...

截图: [文件名]

环境信息:
- 浏览器: [Chrome/Firefox/Edge + 版本]
- 操作系统: Windows 11
- 应用版本: v1.0.0
```

---

## 📊 测试结果汇总

### 通过/失败统计
| 测试用例 | 状态 | 备注 |
|---------|------|------|
| 用例1: 员工+部门 | ⏳ | |  |
| 用例2: 订单+产品+客户 | ⏳ | |  |
| 用例3: 单Sheet对照 | ⏳ | |  |
| 用例4: UI交互 | ⏳ | |  |

### 缺陷统计
- P0 (致命): ___ 个
- P1 (严重): ___ 个
- P2 (一般): ___ 个
- P3 (轻微): ___ 个

---

## 🎯 性能记录

请记录以下操作的耗时：

**场景1: 员工+部门**
- 文件上传: ___ 秒
- AI映射生成: ___ 秒
- 文档生成: ___ 秒
- 总耗时: ___ 秒

**场景2: 订单+产品+客户**
- 文件上传: ___ 秒
- AI映射生成: ___ 秒
- 文档生成: ___ 秒
- 总耗时: ___ 秒

---

## 📝 测试结论

### 总体评价
- [ ] ✅ 通过 - 功能完整，无重大问题
- [ ] ⚠️  有条件通过 - 存在次要问题，但不影响主要功能
- [ ] ❌ 不通过 - 存在重大问题，需要修复

### 主要发现
1. ____
2. ____
3. ____

### 改进建议
1. ____
2. ____
3. ____

---

**测试人员签名**: _______________
**测试完成日期**: _______________
**审核人**: _______________

---

## 附录: 快捷操作

### 键盘快捷键
- `Ctrl + S`: 保存
- `Ctrl + Z`: 撤销
- `F5`: 刷新页面

### 浏览器开发者工具
- `F12`: 打开开发者工具
- `Ctrl + Shift + C`: 选择元素
- `Console` 标签: 查看错误日志
- `Network` 标签: 查看网络请求

### 快速导航
- 主页: http://localhost:3000
- 文档空间: 点击"文档空间"按钮

---

**测试指南版本**: 1.0.0
**最后更新**: 2026-01-18
