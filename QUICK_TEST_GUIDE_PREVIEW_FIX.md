# 🔍 文档预览修复 - 快速测试指南

## 📋 测试准备

### 需要的测试文件

#### 测试文件1：Word模板（`test-template.docx`）
创建一个包含以下内容的Word文档：
```
==========================================
      员工录用通知书

尊敬的 {{name}} 先生/女士：

您好！我们很高兴地通知您，您已被我公司录用，担任 {{position}} 职位。

入职信息：
- 入职日期：{{startDate}}
- 部门：{{department}}
- 薪资：{{salary}}
- 联系电话：{{phone}}

请在 {{startDate}} 当天携带以下材料到人事部报到。

祝您工作愉快！

人事部
日期：{{issueDate}}
==========================================
```

#### 测试文件2：Excel数据（`test-data.xlsx`）
创建一个包含以下数据的Excel工作表：
| name | position | department | salary | startDate | phone | issueDate |
|------|----------|------------|--------|-----------|-------|-----------|
| 张三 | 软件工程师 | 研发部 | 15000 | 2026-02-15 | 13800138000 | 2026-02-01 |
| 李四 | 产品经理 | 产品部 | 18000 | 2026-02-20 | 13800138001 | 2026-02-01 |
| 王五 | UI设计师 | 设计部 | 14000 | 2026-02-18 | 13800138002 | 2026-02-01 |

**建议**：为测试虚拟化表格性能，可以添加更多行数据（100+行）

---

## 🧪 测试步骤

### 测试1：Word模板预览验证

**操作步骤**：
1. 启动应用：`npm run dev`
2. 打开浏览器访问：`http://localhost:3000`
3. 导航到"文档空间"模块
4. 点击"上传Word模板"按钮
5. 选择 `test-template.docx` 文件上传

**预期结果**：
```
✅ 右侧自动切换到"模板预览"Tab
✅ 预览区域显示完整的HTML格式文档内容
✅ 所有占位符显示为黄色背景高亮：
   - {{name}}
   - {{position}}
   - {{startDate}}
   - {{department}}
   - {{salary}}
   - {{phone}}
   - {{issueDate}}
✅ 左侧"占位符列表"显示7个占位符
✅ 顶部统计信息显示：
   - 占位符数量: 7
   - 文件大小: XX KB
   - 模板ID: 前8位字符
```

**失败标志**：
```
❌ 预览区域完全空白
❌ 只显示纯文本，没有格式
❌ 占位符没有高亮
❌ 左侧占位符列表为空
```

### 测试2：Excel数据预览验证

**操作步骤**：
1. 在同一"文档空间"页面
2. 点击"上传Excel数据"按钮
3. 选择 `test-data.xlsx` 文件上传

**预期结果**：
```
✅ 右侧自动切换到"数据预览"Tab
✅ 虚拟化表格正常显示数据
✅ 表格包含以下列：
   - 序号列（1, 2, 3, ...）
   - name
   - position
   - department
   - salary
   - startDate
   - phone
   - issueDate
✅ 顶部统计信息显示：
   - 数据行数: 3
   - 列数: 7
   - 工作表: 1
✅ 搜索功能可用（输入"张三"应该过滤出第一行）
✅ 排序功能可用（点击表头可以排序）
✅ 滚动流畅（如果有大量数据）
```

**失败标志**：
```
❌ 表格不显示或显示错误
❌ 数据不完整
❌ 搜索/排序不工作
❌ 滚动卡顿
```

### 测试3：Tab切换逻辑验证

**操作步骤**：
1. 确保已同时上传Word模板和Excel数据
2. 手动点击"模板预览"Tab
3. 手动点击"数据预览"Tab

**预期结果**：
```
✅ 点击Tab时，内容正确切换
✅ Tab状态正确保持（选中状态）
✅ 切换流畅，无闪烁
```

### 测试4：性能验证（可选）

**操作步骤**：
1. 创建一个包含1000+行数据的Excel文件
2. 上传该文件
3. 快速滚动表格

**预期结果**：
```
✅ 表格快速渲染，不卡顿
✅ 滚动流畅（虚拟化生效）
✅ 开发模式下显示性能统计：
   "虚拟化表格 | 总行数: 1000+ | 可见行: ~15 | 渲染优化: 只渲染可见区域"
```

---

## 🐛 故障排查

### 问题1：Word模板预览仍然空白

**检查项**：
```bash
# 1. 检查浏览器控制台
F12 -> Console Tab -> 查看是否有错误信息

# 2. 检查网络请求
F12 -> Network Tab -> 查看文件是否成功上传

# 3. 检查文件格式
确保文件是 .docx 格式，不是 .doc

# 4. 检查文件内容
确保文件中包含 {{placeholder}} 格式的占位符
```

**解决方案**：
- 重新上传文件
- 使用新的Word文档
- 检查文件是否损坏

### 问题2：虚拟化表格不显示

**检查项**：
```bash
# 1. 检查react-window是否正确安装
npm list react-window

# 2. 检查数据格式
F12 -> Console Tab -> 输入: excelData
查看数据结构是否正确

# 3. 检查浏览器兼容性
确保使用现代浏览器（Chrome, Firefox, Edge）
```

**解决方案**：
- 重新安装依赖：`npm install`
- 清除浏览器缓存
- 尝试其他浏览器

### 问题3：占位符不高亮显示

**检查项**：
```bash
# 1. 检查CSS是否加载
F12 -> Elements Tab -> 查找 .bg-yellow-200 类

# 2. 检查HTML内容
F12 -> Console Tab -> 输入: templateFile.htmlPreview
查看是否是HTML格式
```

**解决方案**：
- 硬刷新浏览器：`Ctrl+F5`
- 清除应用状态，重新上传

---

## ✅ 测试检查清单

### Word模板预览功能
- [ ] 文件上传成功
- [ ] 预览区域显示HTML内容
- [ ] 占位符黄色高亮显示
- [ ] 占位符列表正确显示
- [ ] 统计信息准确
- [ ] 复制占位符功能可用

### Excel数据预览功能
- [ ] 文件上传成功
- [ ] 虚拟化表格正常渲染
- [ ] 数据完整显示
- [ ] 搜索功能正常
- [ ] 排序功能正常
- [ ] 滚动流畅（大数据集）
- [ ] 统计信息准确

### Tab切换功能
- [ ] 上传模板后自动切换到模板预览
- [ ] 上传数据后自动切换到数据预览
- [ ] 手动切换Tab正常
- [ ] Tab状态正确保持

---

## 📊 测试结果记录

### 测试环境
```
浏览器: _____________ 版本: _____________
操作系统: _____________
Node版本: _____________
测试日期: _____________
```

### 测试结果
```
测试1 - Word模板预览: [ ] 通过 [ ] 失败
测试2 - Excel数据预览: [ ] 通过 [ ] 失败
测试3 - Tab切换逻辑: [ ] 通过 [ ] 失败
测试4 - 性能验证: [ ] 通过 [ ] 失败 [ ] 未测试
```

### 问题描述
```
（如有问题，请详细描述）
_________________________________________________
_________________________________________________
_________________________________________________
```

---

## 🎯 快速验证命令

```bash
# 1. 启动开发服务器
npm run dev

# 2. 构建验证
npm run build

# 3. 类型检查
npx tsc --noEmit --skipLibCheck

# 4. 查看修复的文件
git diff services/templateService.ts
git diff types/documentTypes.ts
git diff components/DocumentSpace/VirtualizedDataTable.tsx
```

---

## 📞 获取帮助

如果测试失败：
1. 📋 查看详细的修复报告：`DOCUMENT_PREVIEW_FIX_SUCCESS_REPORT.md`
2. 🔍 检查浏览器控制台的错误信息
3. 📝 记录详细的失败步骤和现象
4. 🚀 提交Issue并附上测试结果

---

**祝测试顺利！** 🎉
