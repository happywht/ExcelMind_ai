# QueryVisualizer 组件系统 - 项目概览

## 系统架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                     QueryVisualizer 主组件                        │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  顶部工具栏                                                │  │
│  │  - 视图切换（表格/图表/统计）                               │  │
│  │  - 查询信息（行数/执行时间）                                │  │
│  │  - 操作按钮（导出/刷新/编辑/设置）                          │  │
│  └───────────────────────────────────────────────────────────┘  │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  设置面板（可选）                                          │  │
│  │  - 虚拟滚动开关                                            │  │
│  │  - 最大行数配置                                            │  │
│  └───────────────────────────────────────────────────────────┘  │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  查询说明（可选）                                          │  │
│  └───────────────────────────────────────────────────────────┘  │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                    主内容区域                               │  │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐          │  │
│  │  │  TableView  │ │ ChartView   │ │ StatsPanel  │          │  │
│  │  │  表格视图    │ │  图表视图   │ │  统计面板   │          │  │
│  │  │  - 排序     │ │  - 柱状图   │ │  - 整体统计 │          │  │
│  │  │  - 过滤     │ │  - 折线图   │ │  - 列统计   │          │  │
│  │  │  - 分页     │ │  - 饼图     │ │  - 数据质量 │          │  │
│  │  │  - 列配置   │ │  - 散点图   │ │  - 数据预览 │          │  │
│  │  │             │ │  - 面积图   │ │             │          │  │
│  │  └─────────────┘ └─────────────┘ └─────────────┘          │  │
│  └───────────────────────────────────────────────────────────┘  │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  ExportDialog 导出对话框（模态）                           │  │
│  │  - 格式选择（CSV/Excel/JSON/PNG）                          │  │
│  │  - 文件名输入                                              │  │
│  │  - 数据预览                                                │  │
│  └───────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

## 组件关系图

```
┌─────────────────────────────────────────────────────────────┐
│                     用户应用层                                │
│  ┌──────────────────┐      ┌──────────────────┐             │
│  │ SmartExcel       │      │ QueryPage        │             │
│  │ Component        │      │ Component        │             │
│  └────────┬─────────┘      └────────┬─────────┘             │
└───────────┼──────────────────────────┼──────────────────────┘
            │                          │
            │ 使用                     │ 使用
            ▼                          ▼
┌─────────────────────────────────────────────────────────────┐
│                   QueryVisualizerExample                     │
│  ┌─────────────────────────────────────────────────────┐    │
│  │  - 查询输入（自然语言/SQL）                           │    │
│  │  - 快速查询示例                                       │    │
│  │  - 查询执行引擎                                       │    │
│  │  - 结果展示                                           │    │
│  └─────────────────────────────────────────────────────┘    │
└───────────────────────────┬─────────────────────────────────┘
                            │ 调用
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                     QueryVisualizer                          │
│  主组件 - 协调所有视图和功能                                 │
└───────────┬───────────────────┬───────────────┬────────────┘
            │                   │               │
            │ 包含              │ 包含          │ 包含
            ▼                   ▼               ▼
    ┌───────────────┐   ┌──────────────┐  ┌─────────────┐
    │  TableView    │   │  ChartView   │  │ StatsPanel  │
    │  表格视图     │   │  图表视图    │  │ 统计面板    │
    └───────┬───────┘   └──────┬───────┘  └──────┬──────┘
            │                  │                  │
            │ 使用             │ 使用             │
            ▼                  ▼                  ▼
    ┌───────────────┐   ┌──────────────┐  ┌─────────────┐
    │  React        │   │  Recharts    │  │  计算逻辑    │
    │  组件库       │   │  图表库      │  │  (内置)     │
    └───────────────┘   └──────────────┘  └─────────────┘

                            │
                            │ 触发
                            ▼
    ┌───────────────────────────────────────┐
    │        ExportDialog                    │
    │        导出对话框                      │
    │  ┌─────────────────────────────────┐  │
    │  │  - exportToCSV                  │  │
    │  │  - exportToExcel (xlsx)         │  │
    │  │  - exportToJSON                 │  │
    │  │  - exportToPNG (html2canvas)    │  │
    │  └─────────────────────────────────┘  │
    └───────────────────────────────────────┘
```

## 数据流向图

```
┌──────────────┐
│  用户输入     │
│  - 自然语言  │
│  - SQL查询   │
└──────┬───────┘
       │
       ▼
┌──────────────────────┐
│  DataQueryEngine     │
│  查询引擎            │
│  - 解析查询          │
│  - 执行查询          │
│  - 返回结果          │
└──────┬───────────────┘
       │
       ▼
┌──────────────────────┐
│  QueryResult         │
│  查询结果            │
│  - data[]            │
│  - sql               │
│  - executionTime     │
│  - rowCount          │
│  - explanation       │
│  - success/error     │
└──────┬───────────────┘
       │
       ▼
┌───────────────────────────────────────────┐
│         QueryVisualizer                   │
│         (数据分发和视图管理)               │
└───┬─────────┬─────────┬─────────┬─────────┘
    │         │         │         │
    ▼         ▼         ▼         ▼
┌────────┐ ┌────────┐ ┌────────┐ ┌─────────┐
│ Table  │ │ Chart  │ │ Stats  │ │ Export  │
│ View   │ │ View   │ │ Panel  │ │ Dialog  │
└────────┘ └────────┘ └────────┘ └─────────┘
    │         │         │         │
    │         │         │         ▼
    │         │         │    ┌──────────┐
    │         │         │    │  文件    │
    │         │         │    │  下载    │
    │         │         │    └──────────┘
    ▼         ▼         ▼
┌────────────────────────────────────────┐
│         用户交互                        │
│  - 排序、过滤、分页                     │
│  - 切换图表类型                         │
│  - 查看统计信息                         │
│  - 导出数据                             │
└────────────────────────────────────────┘
```

## 技术栈层次

```
┌─────────────────────────────────────────────────────────────┐
│                      应用层                                  │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │ SmartExcel   │  │ QueryPage    │  │ 其他应用     │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    组件层 (QueryVisualizer)                   │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐   │
│  │TableView │  │ChartView │  │StatsPanel│  │ExportDlg │   │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘   │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    框架层                                    │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │ React 19.2   │  │ TypeScript   │  │ Tailwind CSS │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    库层                                      │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │  Recharts    │  │    XLSX      │  │ lucide-react │      │
│  │  (图表)      │  │  (Excel导出) │  │   (图标)     │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    平台层                                    │
│              (浏览器 / Electron)                             │
└─────────────────────────────────────────────────────────────┘
```

## 功能模块映射

```
┌─────────────────────────────────────────────────────────────┐
│                    QueryVisualizer                           │
│                    主组件控制器                               │
└───┬───────────────────────────────────────────────┬─────────┘
    │                                               │
    ├─────────────────────────────────────────────┤
    │              视图管理模块                       │
    ├─────────────────────────────────────────────┤
    │  ┌─────────┐  ┌─────────┐  ┌─────────┐      │
    │  │ 表格    │  │ 图表    │  │ 统计    │      │
    │  │ 视图    │  │ 视图    │  │ 面板    │      │
    │  └─────────┘  └─────────┘  └─────────┘      │
    │       │            │            │            │
    │       ▼            ▼            ▼            │
    │  ┌─────────┐  ┌─────────┐  ┌─────────┐      │
    │  │ 排序    │  │ 柱状图  │  │ 整体    │      │
    │  │ 过滤    │  │ 折线图  │  │ 统计    │      │
    │  │ 分页    │  │ 饼图    │  │ 列统计  │      │
    │  │ 列配置  │  │ 散点图  │  │ 数据    │      │
    │  │         │  │ 面积图  │  │ 质量    │      │
    │  └─────────┘  └─────────┘  └─────────┘      │
    └─────────────────────────────────────────────┘
    │
    ├─────────────────────────────────────────────┤
    │              交互模块                         │
    ├─────────────────────────────────────────────┤
    │  ┌─────────┐  ┌─────────┐  ┌─────────┐      │
    │  │ 导出    │  │ 刷新    │  │ 编辑    │      │
    │  │ 数据    │  │ 查询    │  │ 查询    │      │
    │  └─────────┘  └─────────┘  └─────────┘      │
    │       │                                       │
    │       ▼                                       │
    │  ┌─────────────────────────────────────┐     │
    │  │         ExportDialog                 │     │
    │  │  - CSV / Excel / JSON / PNG         │     │
    │  └─────────────────────────────────────┘     │
    └─────────────────────────────────────────────┘
    │
    ├─────────────────────────────────────────────┤
    │              状态管理模块                     │
    ├─────────────────────────────────────────────┤
    │  ┌─────────┐  ┌─────────┐  ┌─────────┐      │
    │  │ Loading │  │  Empty  │  │  Error  │      │
    │  │ 状态    │  │  状态   │  │  状态   │      │
    │  └─────────┘  └─────────┘  └─────────┘      │
    └─────────────────────────────────────────────┘
    │
    ├─────────────────────────────────────────────┤
    │              配置模块                         │
    ├─────────────────────────────────────────────┤
    │  ┌─────────┐  ┌─────────┐  ┌─────────┐      │
    │  │ 视图    │  │ 虚拟    │  │ 最大    │      │
    │  │ 配置    │  │ 滚动    │  │ 行数    │      │
    │  └─────────┘  └─────────┘  └─────────┘      │
    └─────────────────────────────────────────────┘
```

## 颜色系统

```
┌─────────────────────────────────────────────────────────────┐
│                    颜色方案                                   │
├─────────────────────────────────────────────────────────────┤
│  主色调                                                      │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  Primary:    #3b82f6 (蓝色)                          │  │
│  │  Success:    #10b981 (绿色)                          │  │
│  │  Warning:    #f59e0b (橙色)                          │  │
│  │  Danger:     #ef4444 (红色)                          │  │
│  │  Info:       #6366f1 (靛蓝)                         │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
│  中性色                                                      │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  Background: #ffffff (白色)                          │  │
│  │  Border:     #e5e7eb (灰色)                          │  │
│  │  Text:       #1e293b (深灰)                          │  │
│  │  Text-Light: #64748b (中灰)                          │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
│  图表颜色方案                                                │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  Default:   蓝绿红紫靛... (10色)                      │  │
│  │  Pastel:    柔和色调 (10色)                           │  │
│  │  Vibrant:   鲜艳色调 (10色)                           │  │
│  │  Monochrome: 单色渐变 (10色)                          │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

## 响应式断点

```
┌─────────────────────────────────────────────────────────────┐
│                    响应式设计                                 │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Mobile:    < 640px   (sm)                                  │
│  ┌──────────────────────┐                                  │
│  │  单列布局             │                                  │
│  │  隐藏次要功能         │                                  │
│  └──────────────────────┘                                  │
│                                                             │
│  Tablet:    640px - 1024px (md, lg)                         │
│  ┌──────────────────────────────────────┐                  │
│  │  两列布局                              │                  │
│  │  显示主要功能                          │                  │
│  └──────────────────────────────────────┘                  │
│                                                             │
│  Desktop:   > 1024px   (xl, 2xl)                            │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  三列布局或多列布局                                    │  │
│  │  显示所有功能                                          │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

**文档版本**: v1.0.0
**最后更新**: 2024-01-15
**作者**: ExcelMind AI Team
