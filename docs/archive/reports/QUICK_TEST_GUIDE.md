# 🧪 SmartExcel 多Sheet功能 - 快速测试指南

## 📋 测试准备

### 1. 准备测试文件
创建一个包含多个sheets的Excel文件（例如 `test-multisheet.xlsx`）：

**Sheet1 (员工数据)**:
| ID | 姓名 | 部门 | 金额 |
|----|------|------|------|
| 1 | 张三 | 销售部 | 5000 |
| 2 | 李四 | 技术部 | 6000 |
| 3 | 王五 | 销售部 | 5500 |

**Sheet2 (排除名单)**:
| ID | 排除原因 |
|----|----------|
| 2 | 离职员工 |

### 2. 启动应用
```bash
npm run dev
```

---

## 🧪 测试场景

### 场景1：单Sheet文件（向后兼容测试）

**步骤**:
1. 上传只有一个sheet的Excel文件
2. 输入指令：`筛选出金额大于5000的记录`
3. 点击"执行智能处理"

**预期结果**:
- ✅ 正常处理，不报错
- ✅ 结果正确
- ✅ 与修复前行为一致

---

### 场景2：多Sheet基础操作

**步骤**:
1. 上传包含多个sheets的Excel文件
2. 输入指令：`对Sheet1的数据进行筛选，保留金额大于5000的记录`
3. 点击"执行智能处理"

**预期结果**:
- ✅ AI能识别出有多个sheets
- ✅ 日志显示所有sheets的信息
- ✅ 正确处理Sheet1的数据
- ✅ 不再出现"未提供Sheet2的样本数据"错误

**检查日志**:
```
[INFO] 📊 MULTIPLE SHEETS DETECTED (2 sheets):
[INFO]   → Sheet "Sheet1": 3 rows, columns: ID, 姓名, 部门, 金额
[INFO]     Sheet "Sheet2": 1 rows, columns: ID, 排除原因
```

---

### 场景3：跨Sheet操作 ⭐ 核心测试

**步骤**:
1. 上传包含多个sheets的Excel文件
2. 输入指令：`使用Sheet2作为排除名单，从Sheet1中移除ID匹配的记录`
3. 点击"执行智能处理"

**预期结果**:
- ✅ AI能看到Sheet1和Sheet2的数据
- ✅ 正确识别关联字段（ID）
- ✅ 执行跨sheet过滤操作
- ✅ 结果只包含ID为1和3的记录（移除了ID为2的记录）

**检查日志**:
```
[INFO] 📊 MULTIPLE SHEETS DETECTED (2 sheets)
[INFO] 📄 CURRENT SHEET: "Sheet1"
[INFO] HEADERS: ["ID", "姓名", "部门", "金额"]
[INFO] 📄 SHEET: "Sheet2"
[INFO] HEADERS: ["ID", "排除原因"]
[SUCCESS] 执行完成。处理了 1 个文件。
```

**检查结果**:
- 结果文件应该只包含2行记录（张三和王五）
- 李四的记录被正确移除

---

### 场景4：创建多Sheet结果

**步骤**:
1. 上传包含多个sheets的Excel文件
2. 输入指令：`创建一个新文件，包含两个sheets：'汇总'（按部门汇总金额）和'明细'（原始数据）`
3. 点击"执行智能处理"

**预期结果**:
- ✅ AI理解要创建多sheet结果
- ✅ 正确生成汇总数据
- ✅ 创建包含两个sheets的结果文件
- ✅ 结果文件能正确下载和打开

**检查结果**:
- 下载结果文件
- 用Excel打开，验证包含两个sheets
- 验证汇总sheet的数据正确性

---

## ✅ 验证标准

### 功能验证
- [ ] 单sheet文件正常工作
- [ ] AI能看到所有sheets的信息
- [ ] 跨sheet操作能正确执行
- [ ] 能创建多sheet结果文件
- [ ] 不再出现"未提供Sheet2的样本数据"错误

### 日志验证
- [ ] 日志显示"MULTIPLE SHEETS DETECTED"
- [ ] 日志显示所有sheets的名称和字段
- [ ] 日志显示每个sheets的样本数据
- [ ] 日志显示当前活动的sheet

### 结果验证
- [ ] 处理结果正确
- [ ] 结果文件能正常下载
- [ ] 多sheet结果文件结构正确
- [ ] 数据完整性保持

---

## 🐛 常见问题

### Q1: 日志仍显示"未提供Sheet2的样本数据"
**A**: 检查：
1. 确认已重启应用（修复后需要重新编译）
2. 清除浏览器缓存
3. 检查控制台是否有编译错误

### Q2: 跨sheet操作结果不正确
**A**: 检查：
1. 确认AI能识别关联字段
2. 查看AI生成的代码
3. 验证数据格式是否一致

### Q3: 单sheet文件出现问题
**A**: 检查：
1. 确认是真正的单sheet文件
2. 查看控制台错误信息
3. 验证向后兼容性是否被破坏

---

## 📊 测试报告模板

```
SmartExcel 多Sheet功能测试报告
测试日期: __________
测试人员: __________

场景1: 单Sheet文件（向后兼容）
结果: [ ] 通过 [ ] 失败
备注: ___________________________

场景2: 多Sheet基础操作
结果: [ ] 通过 [ ] 失败
备注: ___________________________

场景3: 跨Sheet操作 ⭐
结果: [ ] 通过 [ ] 失败
备注: ___________________________

场景4: 创建多Sheet结果
结果: [ ] 通过 [ ] 失败
备注: ___________________________

总体评价: [ ] 优秀 [ ] 良好 [ ] 需要改进
建议: ___________________________
```

---

## 🎯 测试完成标准

所有测试场景通过，并且：
1. ✅ 功能验证全部通过
2. ✅ 日志输出正确
3. ✅ 结果数据准确
4. ✅ 向后兼容性保持
5. ✅ 无性能退化

---

## 📞 需要帮助？

- 查看详细文档: `MULTISHEET_FIX_README.md`
- 查看修复报告: `MULTISHEET_FIX_SUMMARY.md`
- 打开可视化页面: `test-multisheet.html`
- 运行验证脚本: `node verify-fix.js`

---

**祝测试顺利！** 🎉
