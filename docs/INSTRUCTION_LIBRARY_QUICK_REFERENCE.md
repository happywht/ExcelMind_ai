# 指令库设计 - 快速参考指南

## 核心问题

> **如何评估哪些指令是常用的、通用的、可复用的？**

**答案**：数据驱动的多维度评估，而非主观臆断。

---

## 三大评估维度

### 1. 使用频率 (Frequency) - 权重 30%
- **指标**：每日使用次数、用户渗透率
- **阈值**：
  - 高频：≥10次/天
  - 中频：5-10次/天
  - 低频：<5次/天

### 2. AI生成难度 (AI Difficulty) - 权重 35%
- **指标**：AI成功率、平均重试次数、错误率
- **阈值**：
  - 困难：成功率 <75%
  - 中等：成功率 75-85%
  - 容易：成功率 >85%

### 3. 用户满意度 (User Satisfaction) - 权重 25%
- **指标**：用户评分、任务完成率
- **阈值**：
  - 高满意度：≥4.5/5.0
  - 中满意度：3.5-4.5/5.0
  - 低满意度：<3.5/5.0

---

## 决策矩阵

| 使用频率 | AI成功率 | 用户满意度 | 决策 | 优先级 |
|---------|---------|-----------|------|--------|
| 高频 (>10次/天) | 低 (<75%) | 高 (≥4.5) | ✅ 必须加入 | **95-100** |
| 高频 (>10次/天) | 中 (75-85%) | 高 (≥4.5) | ✅ 强烈建议 | **85-94** |
| 高频 (>10次/天) | 高 (>85%) | 高 (≥4.5) | ✅ 建议（提升体验） | **75-84** |
| 中频 (5-10次/天) | 低 (<75%) | 中 (≥3.5) | ✅ 建议 | **70-84** |
| 中频 (5-10次/天) | 高 (>85%) | 高 (≥4.5) | ⚠️ 可选 | **60-69** |
| 低频 (<5次/天) | 任意 | 任意 | ❌ 不加入 | **<60** |
| 任意 | 高 (>90%) | 低 (<3.5) | ❌ 需优化AI | **0** |

---

## 数据收集方法

### 1. 后端日志收集
```typescript
// api/controllers/smartProcessController.ts
await logCommandUsage({
  instruction: command,
  success: result.success,
  executionTime: result.executionSummary.totalTime,
  rating: req.body.rating
});
```

### 2. 前端埋点
```typescript
// 用户提交指令
analytics.track('instruction_submitted', {
  instruction: userInstruction,
  userId: currentUserId
});

// 用户修改结果
analytics.track('result_modified', {
  instruction: originalInstruction,
  modified: true,
  timeSpent: modificationTime
});

// 用户评分
analytics.track('result_rated', {
  rating: userRating,
  instruction: originalInstruction
});
```

### 3. 模式提取
```typescript
// "筛选出年龄大于30的记录" -> "筛选出{列名}{条件}{值}"
function extractPattern(instruction: string): string {
  return instruction
    .replace(/\d+/g, '{值}')
    .replace(/["'][^"']*["']/g, '{文本}')
    .replace(/年龄|工资|部门/g, '{列名}');
}
```

---

## 指令库分类体系

### 按复杂度分类

#### 简单操作 (Simple)
- 单步操作
- 示例：筛选、排序、统计
- **优先级**：高（用户常用）

#### 中等操作 (Medium)
- 2-3步操作
- 示例：筛选后排序、分组统计
- **优先级**：中

#### 复杂操作 (Complex)
- 4步以上操作
- 示例：多条件筛选+分组+排序+统计
- **优先级**：低（让AI生成）

### 按功能分类

1. **数据筛选** (Filter) - 频率: 45%
2. **数据排序** (Sort) - 频率: 38%
3. **数据统计** (Aggregate) - 频率: 62%
4. **数据查找** (Lookup) - 频率: 29%
5. **数据转换** (Transform) - 频率: 25%
6. **数据分组** (Group) - 频率: 34%

---

## Top 10 常用指令模板

### 1. 简单筛选
```
模板：筛选出{列名}{条件}{值}的记录
示例：筛选出年龄大于30的记录
优先级：95
```

### 2. 数据统计
```
模板：计算{列名}的{统计函数}
示例：计算工资的平均值
优先级：94
```

### 3. 简单排序
```
模板：按{列名}{顺序}排列
示例：按工资降序排列
优先级：90
```

### 4. 分组统计
```
模板：按{分组列}统计{统计列}的{统计函数}
示例：按部门统计工资的平均值
优先级：86
```

### 5. 多条件筛选
```
模板：筛选出{列1}{条件1}{值1}，且{列2}{条件2}{值2}的记录
示例：筛选出年龄大于30，且工资小于5000的记录
优先级：78
```

### 6. 筛选后排序
```
模板：筛选出{列1}{条件}{值}，按{列2}{顺序}排列
示例：筛选出年龄大于30的记录，按工资降序排列
优先级：76
```

### 7. 筛选后统计
```
模板：筛选出{列1}{条件}{值}，统计{列2}的{统计函数}
示例：筛选出部门等于"销售"的记录，统计工资的平均值
优先级：80
```

### 8. 多列排序
```
模板：按{列1}{顺序1}排列，相同时按{列2}{顺序2}排列
示例：按部门降序排列，相同时按工资升序排列
优先级：62
```

### 9. 日期格式转换
```
模板：将{列名}的格式转换为{目标格式}
示例：将日期列的格式转换为YYYY-MM-DD
优先级：68
```

### 10. 文本转换
```
模板：将{列名}{转换操作}
示例：将姓名转换为大写
优先级：55
```

---

## 实施路线图

### 第1-2周：数据收集
- [ ] 添加日志收集到 `smartProcessController`
- [ ] 前端埋点（提交、修改、评分）
- [ ] 建立数据分析管道

### 第3-4周：数据分析
- [ ] 分析历史数据（如果有的话）
- [ ] 识别高频模式
- [ ] 评估AI生成性能

### 第5-6周：指令库原型
- [ ] 构建Top 10指令
- [ ] 开发推荐系统
- [ ] 集成到现有系统

### 第7-8周：A/B测试
- [ ] A组：仅AI生成
- [ ] B组：指令库 + AI
- [ ] 收集对比数据

### 第9周+：持续优化
- [ ] 根据数据迭代
- [ ] 扩展指令库
- [ ] 优化用户体验

---

## 关键成功因素

### ✅ 必须做
1. **数据驱动**：基于实际使用数据，而非主观判断
2. **渐进式构建**：从Top 10开始，逐步扩展
3. **持续优化**：建立反馈循环，定期更新
4. **用户参与**：早期邀请核心用户测试

### ❌ 避免做
1. **凭空设计**：没有数据支持的指令库
2. **过度设计**：一次性加入太多指令
3. **静态维护**：不更新、不优化
4. **忽视AI**：与AI生成竞争而非互补

---

## 指令库 vs AI生成

### 指令库适合的场景
- ✅ 高频操作（>10次/天）
- ✅ AI容易出错（成功率<75%）
- ✅ 新手用户不知道怎么描述
- ✅ 需要快速响应（<2秒）

### AI生成适合的场景
- ✅ 低频操作（<5次/天）
- ✅ 复杂、个性化操作
- ✅ 有特殊业务逻辑
- ✅ AI生成准确（成功率>90%）

### 协同策略
```
用户输入
  ↓
分析输入语义
  ↓
匹配指令库
  ├─ 完全匹配 → 使用指令库（快速、准确）
  ├─ 部分匹配 → 推荐指令 + AI补充
  └─ 无匹配 → AI生成（灵活、强大）
  ↓
返回结果
```

---

## 评估指标

### 业务指标
- 指令库使用率：目标 >40%
- 每会话平均使用指令数：目标 >2
- 重复使用率：目标 >60%

### 性能指标
- 平均执行时间：目标 <3秒
- 成功率：目标 >95%
- 错误率：目标 <5%

### 用户体验指标
- 满意度评分：目标 >4.5/5.0
- 任务完成率：目标 >90%
- 修改率：目标 <10%

### AI对比指标
- 速度提升：目标 >50%
- 准确率提升：目标 >20%
- 成本节省：目标 >30%

---

## 总结

### 核心原则
1. **数据驱动**：用数据说话，不凭直觉
2. **用户中心**：以用户满意度为最终标准
3. **渐进式**：小步快跑，持续迭代
4. **平衡策略**：指令库与AI生成互补

### 最终答案

**如何评估哪些指令是常用的、通用的、可复用的？**

```
常用性 = 使用频率 × 0.30 + AI难度 × 0.35 + 用户满意度 × 0.25 + 复杂度 × 0.10

得分 ≥ 70 → 加入指令库
得分 < 70 → 让AI生成
```

**否则还不如让AI单独生成？**

- 指令库不是替代AI，而是**补充AI**
- 高频、AI困难、用户满意的指令 → 指令库
- 低频、AI容易、个性化的指令 → AI生成
- 两者结合，提供最佳用户体验

---

**文档版本**：v1.0
**最后更新**：2026-01-28
**作者**：产品团队
