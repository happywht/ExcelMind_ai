# VirtualWorkspace æµ‹è¯•æŠ¥å‘Š

## æµ‹è¯•æ¦‚è¿°

**æµ‹è¯•æ¨¡å—**: VirtualWorkspace ç»„ä»¶å¥—ä»¶
**æµ‹è¯•æ—¥æœŸ**: 2026-01-24
**æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡**: 70%+
**æµ‹è¯•æ¡†æ¶**: Jest + React Testing Library

## æµ‹è¯•æ–‡ä»¶æ¸…å•

### 1. VirtualFileBrowser.test.tsx
**æ–‡ä»¶è·¯å¾„**: `components/VirtualWorkspace/__tests__/VirtualFileBrowser.test.tsx`
**æµ‹è¯•ç”¨ä¾‹æ•°**: ~35 ä¸ª
**ä»£ç è¡Œæ•°**: ~450 è¡Œ

**æµ‹è¯•è¦†ç›–**:
- âœ… æ¸²æŸ“æµ‹è¯• (6 ä¸ªç”¨ä¾‹)
- âœ… æ–‡ä»¶é€‰æ‹©åŠŸèƒ½ (2 ä¸ªç”¨ä¾‹)
- âœ… æœç´¢åŠŸèƒ½ (3 ä¸ªç”¨ä¾‹)
- âœ… è§†å›¾åˆ‡æ¢ (3 ä¸ªç”¨ä¾‹)
- âœ… æ’åºåŠŸèƒ½ (2 ä¸ªç”¨ä¾‹)
- âœ… è¿‡æ»¤åŠŸèƒ½ (3 ä¸ªç”¨ä¾‹)
- âœ… æ–‡ä»¶ä¸Šä¼  (2 ä¸ªç”¨ä¾‹)
- âœ… æ–‡ä»¶æ“ä½œ (2 ä¸ªç”¨ä¾‹)
- âœ… åˆ·æ–°åŠŸèƒ½ (2 ä¸ªç”¨ä¾‹)
- âœ… å“åº”å¼è¡Œä¸º (1 ä¸ªç”¨ä¾‹)
- âœ… å¯è®¿é—®æ€§ (2 ä¸ªç”¨ä¾‹)
- âœ… é”™è¯¯å¤„ç† (2 ä¸ªç”¨ä¾‹)
- âœ… æ€§èƒ½æµ‹è¯• (1 ä¸ªç”¨ä¾‹)

**å…³é”®æµ‹è¯•åœºæ™¯**:
```typescript
âœ“ ç»„ä»¶æ­£ç¡®æ¸²æŸ“
âœ“ æ˜¾ç¤ºæ–‡ä»¶åˆ—è¡¨å’Œè®¡æ•°
âœ“ ç©ºçŠ¶æ€æ˜¾ç¤º
âœ“ å•é€‰å’Œå¤šé€‰åŠŸèƒ½
âœ“ æ–‡ä»¶æœç´¢å’Œè¿‡æ»¤
âœ“ ç½‘æ ¼/æ ‘å½¢è§†å›¾åˆ‡æ¢
âœ“ æ‹–æ‹½ä¸Šä¼ 
âœ“ æ–‡ä»¶ä¸‹è½½å’Œåˆ é™¤
âœ“ åˆ·æ–°å’ŒåŠ è½½çŠ¶æ€
âœ“ é”™è¯¯å¤„ç†
```

---

### 2. RelationshipGraph.test.tsx
**æ–‡ä»¶è·¯å¾„**: `components/VirtualWorkspace/__tests__/RelationshipGraph.test.tsx`
**æµ‹è¯•ç”¨ä¾‹æ•°**: ~25 ä¸ª
**ä»£ç è¡Œæ•°**: ~380 è¡Œ

**æµ‹è¯•è¦†ç›–**:
- âœ… æ¸²æŸ“æµ‹è¯• (5 ä¸ªç”¨ä¾‹)
- âœ… å·¥å…·æ åŠŸèƒ½ (6 ä¸ªç”¨ä¾‹)
- âœ… ç¼©æ”¾åŠŸèƒ½ (3 ä¸ªç”¨ä¾‹)
- âœ… å¹³ç§»åŠŸèƒ½ (1 ä¸ªç”¨ä¾‹)
- âœ… å›¾ä¾‹åŠŸèƒ½ (3 ä¸ªç”¨ä¾‹)
- âœ… èŠ‚ç‚¹äº¤äº’ (2 ä¸ªç”¨ä¾‹)
- âœ… è¾¹äº¤äº’ (1 ä¸ªç”¨ä¾‹)
- âœ… å¸ƒå±€ç®—æ³• (4 ä¸ªç”¨ä¾‹)
- âœ… å…¨å±åŠŸèƒ½ (2 ä¸ªç”¨ä¾‹)
- âœ… å¯¼å‡ºåŠŸèƒ½ (1 ä¸ªç”¨ä¾‹)
- âœ… å¯è®¿é—®æ€§ (1 ä¸ªç”¨ä¾‹)
- âœ… é”™è¯¯å¤„ç† (1 ä¸ªç”¨ä¾‹)
- âœ… å“åº”å¼è¡Œä¸º (1 ä¸ªç”¨ä¾‹)

**å…³é”®æµ‹è¯•åœºæ™¯**:
```typescript
âœ“ SVG ç”»å¸ƒæ¸²æŸ“
âœ“ èŠ‚ç‚¹å’Œè¾¹æ˜¾ç¤º
âœ“ ç¼©æ”¾å’Œå¹³ç§»æ“ä½œ
âœ“ å››ç§å¸ƒå±€ç®—æ³•
âœ“ èŠ‚ç‚¹ç‚¹å‡»å’Œè¯¦æƒ…
âœ“ å›¾ä¾‹æ˜¾ç¤º/éšè—
âœ“ å…¨å±æ¨¡å¼
âœ“ å¯¼å‡ºä¸ºå›¾ç‰‡
```

---

### 3. WorkspaceRecovery.test.tsx
**æ–‡ä»¶è·¯å¾„**: `components/VirtualWorkspace/__tests__/WorkspaceRecovery.test.tsx`
**æµ‹è¯•ç”¨ä¾‹æ•°**: ~30 ä¸ª
**ä»£ç è¡Œæ•°**: ~420 è¡Œ

**æµ‹è¯•è¦†ç›–**:
- âœ… æ¸²æŸ“æµ‹è¯• (7 ä¸ªç”¨ä¾‹)
- âœ… è¿‡æ»¤åŠŸèƒ½ (4 ä¸ªç”¨ä¾‹)
- âœ… ä¼šè¯æ¢å¤ (2 ä¸ªç”¨ä¾‹)
- âœ… ä¼šè¯åˆ é™¤ (2 ä¸ªç”¨ä¾‹)
- âœ… æ¸…é™¤å…¨éƒ¨åŠŸèƒ½ (4 ä¸ªç”¨ä¾‹)
- âœ… ä¼šè¯è¯¦æƒ… (6 ä¸ªç”¨ä¾‹)
- âœ… ä¼šè¯å¡ç‰‡äº¤äº’ (2 ä¸ªç”¨ä¾‹)
- âœ… è‡ªåŠ¨æ¸…ç† (2 ä¸ªç”¨ä¾‹)
- âœ… æœ€å¤§ä¼šè¯é™åˆ¶ (1 ä¸ªç”¨ä¾‹)
- âœ… å¯è®¿é—®æ€§ (2 ä¸ªç”¨ä¾‹)
- âœ… é”™è¯¯å¤„ç† (2 ä¸ªç”¨ä¾‹)
- âœ… å“åº”å¼è¡Œä¸º (1 ä¸ªç”¨ä¾‹)

**å…³é”®æµ‹è¯•åœºæ™¯**:
```typescript
âœ“ ä¼šè¯åˆ—è¡¨æ˜¾ç¤º
âœ“ çŠ¶æ€è¿‡æ»¤ï¼ˆå…¨éƒ¨/å·²å®Œæˆ/å¤±è´¥/è¿›è¡Œä¸­ï¼‰
âœ“ ä¼šè¯æ¢å¤å’Œé€‰é¡¹ä¼ é€’
âœ“ å•ä¸ªå’Œæ‰¹é‡åˆ é™¤
âœ“ ç¡®è®¤å¯¹è¯æ¡†äº¤äº’
âœ“ è¿›åº¦å’Œé”™è¯¯æ˜¾ç¤º
âœ“ è‡ªåŠ¨æ¸…ç†è¿‡æœŸä¼šè¯
```

---

### 4. FileCard.test.tsx
**æ–‡ä»¶è·¯å¾„**: `components/VirtualWorkspace/__tests__/FileCard.test.tsx`
**æµ‹è¯•ç”¨ä¾‹æ•°**: ~28 ä¸ª
**ä»£ç è¡Œæ•°**: ~380 è¡Œ

**æµ‹è¯•è¦†ç›–**:
- âœ… æ ‡å‡†æ¨¡å¼æ¸²æŸ“ (8 ä¸ªç”¨ä¾‹)
- âœ… ç´§å‡‘æ¨¡å¼æ¸²æŸ“ (3 ä¸ªç”¨ä¾‹)
- âœ… é€‰æ‹©åŠŸèƒ½ (5 ä¸ªç”¨ä¾‹)
- âœ… æ“ä½œèœå• (8 ä¸ªç”¨ä¾‹)
- âœ… æ‚¬åœæ•ˆæœ (1 ä¸ªç”¨ä¾‹)
- âœ… ä¸åŒæ–‡ä»¶ç±»å‹ (5 ä¸ªç”¨ä¾‹)
- âœ… ä¸åŒæ–‡ä»¶è§’è‰² (5 ä¸ªç”¨ä¾‹)
- âœ… ç‰¹æ®Šæ–‡ä»¶çŠ¶æ€ (4 ä¸ªç”¨ä¾‹)
- âœ… å¯è®¿é—®æ€§ (2 ä¸ªç”¨ä¾‹)

**å…³é”®æµ‹è¯•åœºæ™¯**:
```typescript
âœ“ æ–‡ä»¶ä¿¡æ¯å®Œæ•´æ˜¾ç¤º
âœ“ è§’è‰²æ ‡ç­¾å’Œå¼•ç”¨è®¡æ•°
âœ“ æ ‡å‡†å’Œç´§å‡‘æ¨¡å¼
âœ“ å•é€‰å’Œå¤šé€‰æ”¯æŒ
âœ“ æ“ä½œèœå•ï¼ˆæŸ¥çœ‹/ä¸‹è½½/å¤åˆ¶/åˆ é™¤ï¼‰
âœ“ ä¸åŒæ–‡ä»¶ç±»å‹å›¾æ ‡
âœ“ ä¸åŒè§’è‰²é¢œè‰²
âœ“ ç‰¹æ®Šå¤§å°å¤„ç†
```

---

### 5. FileTree.test.tsx
**æ–‡ä»¶è·¯å¾„**: `components/VirtualWorkspace/__tests__/FileTree.test.tsx`
**æµ‹è¯•ç”¨ä¾‹æ•°**: ~22 ä¸ª
**ä»£ç è¡Œæ•°**: ~340 è¡Œ

**æµ‹è¯•è¦†ç›–**:
- âœ… æ¸²æŸ“æµ‹è¯• (6 ä¸ªç”¨ä¾‹)
- âœ… èŠ‚ç‚¹ç±»å‹ (4 ä¸ªç”¨ä¾‹)
- âœ… èŠ‚ç‚¹å±•å¼€/æŠ˜å  (5 ä¸ªç”¨ä¾‹)
- âœ… èŠ‚ç‚¹é€‰æ‹© (3 ä¸ªç”¨ä¾‹)
- âœ… åµŒå¥—å±‚çº§ (2 ä¸ªç”¨ä¾‹)
- âœ… ä¸åŒæ–‡ä»¶ç±»å‹ (3 ä¸ªç”¨ä¾‹)
- âœ… äº¤äº’è¡Œä¸º (2 ä¸ªç”¨ä¾‹)
- âœ… æ€§èƒ½æµ‹è¯• (2 ä¸ªç”¨ä¾‹)
- âœ… å¯è®¿é—®æ€§ (2 ä¸ªç”¨ä¾‹)
- âœ… è¾¹ç•Œæƒ…å†µ (3 ä¸ªç”¨ä¾‹)

**å…³é”®æµ‹è¯•åœºæ™¯**:
```typescript
âœ“ æ ‘å½¢ç»“æ„æ¸²æŸ“
âœ“ ç›®å½•å±•å¼€/æŠ˜å 
âœ“ èŠ‚ç‚¹ç¼©è¿›å’Œå±‚çº§
âœ“ æ–‡ä»¶å’Œç›®å½•å›¾æ ‡
âœ“ èŠ‚ç‚¹é€‰æ‹©é«˜äº®
âœ“ å¤šçº§åµŒå¥—å¤„ç†
âœ“ å¤§å‹æ ‘æ€§èƒ½
```

---

## æµ‹è¯•æ‰§è¡Œ

### è¿è¡Œæ‰€æœ‰ç»„ä»¶æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰ç»„ä»¶æµ‹è¯•
npm test -- components

# è¿è¡Œ VirtualWorkspace ç»„ä»¶æµ‹è¯•
npm test -- components/VirtualWorkspace

# è¿è¡Œå•ä¸ªç»„ä»¶æµ‹è¯•
npm test -- VirtualFileBrowser.test.tsx
```

### ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š

```bash
# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm test -- --coverage --watchAll=false

# æŸ¥çœ‹ç‰¹å®šç»„ä»¶è¦†ç›–ç‡
npm test -- --coverage --collectCoverageFrom="components/VirtualWorkspace/**/*.{ts,tsx}"
```

---

## æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡

### é¢„æœŸè¦†ç›–ç‡

| ç»„ä»¶ | è¯­å¥è¦†ç›–ç‡ | åˆ†æ”¯è¦†ç›–ç‡ | å‡½æ•°è¦†ç›–ç‡ | è¡Œè¦†ç›–ç‡ |
|------|-----------|-----------|-----------|---------|
| VirtualFileBrowser | >70% | >65% | >75% | >70% |
| RelationshipGraph | >70% | >65% | >75% | >70% |
| WorkspaceRecovery | >75% | >70% | >80% | >75% |
| FileCard | >80% | >75% | >85% | >80% |
| FileTree | >75% | >70% | >80% | >75% |
| **æ€»è®¡** | **>70%** | **>65%** | **>75%** | **>70%** |

---

## Mock ç­–ç•¥

### 1. VFS æœåŠ¡ Mock

```typescript
jest.mock('../../../services/infrastructure/vfs/VirtualFileSystem', () => ({
  getVirtualFileSystem: jest.fn(() => ({
    listDirectory: jest.fn(),
    readFile: jest.fn(),
    getRelationships: jest.fn(),
  })),
}));
```

### 2. å·¥å…·å‡½æ•° Mock

```typescript
jest.mock('../utils', () => ({
  getFileIcon: jest.fn(() => 'ğŸ“Š'),
  getFileRoleLabel: jest.fn(() => 'ä¸»æ•°æ®æº'),
  formatFileSize: jest.fn((bytes) => '1.0 MB'),
  // ... å…¶ä»–å·¥å…·å‡½æ•°
}));
```

### 3. æµè§ˆå™¨ API Mock

```typescript
// URL.createObjectURL
global.URL.createObjectURL = jest.fn(() => 'blob:mock-url');

// IntersectionObserver
global.IntersectionObserver = class IntersectionObserver {
  // Mock implementation
};

// ResizeObserver
global.ResizeObserver = class ResizeObserver {
  // Mock implementation
};
```

---

## æµ‹è¯•è´¨é‡æ ‡å‡†

### âœ… å·²å®ç°æ ‡å‡†

1. **ç”¨æˆ·è¡Œä¸ºæµ‹è¯•**: ä½¿ç”¨ `@testing-library/user-event` æ¨¡æ‹ŸçœŸå®ç”¨æˆ·äº¤äº’
2. **å¼‚æ­¥æ“ä½œå¤„ç†**: ä½¿ç”¨ `waitFor` å’Œ `async/await` å¤„ç†å¼‚æ­¥æ“ä½œ
3. **å¯è®¿é—®æ€§æµ‹è¯•**: æµ‹è¯• ARIA æ ‡ç­¾ã€é”®ç›˜å¯¼èˆªå’Œå±å¹•é˜…è¯»å™¨æ”¯æŒ
4. **é”™è¯¯å¤„ç†**: æµ‹è¯•å„ç§é”™è¯¯æƒ…å†µå’Œè¾¹ç•Œæ¡ä»¶
5. **æ€§èƒ½æµ‹è¯•**: éªŒè¯å¤§æ•°æ®é‡ä¸‹çš„æ¸²æŸ“æ€§èƒ½
6. **å“åº”å¼æµ‹è¯•**: æµ‹è¯•ä¸åŒå±å¹•å°ºå¯¸ä¸‹çš„æ˜¾ç¤º

### ğŸ“‹ æµ‹è¯•æœ€ä½³å®è·µ

- âœ… æµ‹è¯•ç”¨æˆ·è¡Œä¸ºè€Œéå®ç°ç»†èŠ‚
- âœ… ä½¿ç”¨æè¿°æ€§çš„æµ‹è¯•åç§°
- âœ… æ¯ä¸ªæµ‹è¯•åªéªŒè¯ä¸€ä¸ªè¡Œä¸º
- âœ… æ­£ç¡®ä½¿ç”¨ `beforeEach` å’Œ `afterEach` æ¸…ç†çŠ¶æ€
- âœ… Mock æ‰€æœ‰å¤–éƒ¨ä¾èµ–
- âœ… ä½¿ç”¨ `data-testid` æˆ– ARIA æ ‡ç­¾é€‰æ‹©å…ƒç´ 

---

## å·²çŸ¥é—®é¢˜å’Œé™åˆ¶

### 1. é›†æˆæµ‹è¯•é™åˆ¶
- æŸäº›å¤æ‚çš„äº¤äº’ï¼ˆå¦‚æ‹–æ‹½ä¸Šä¼ ï¼‰éœ€è¦é¢å¤–çš„ mock é…ç½®
- å…¨å± API éœ€è¦ç‰¹æ®Šå¤„ç†

### 2. æµè§ˆå™¨ API Mock
- éƒ¨åˆ†æµè§ˆå™¨ API å¯èƒ½éœ€è¦æ›´è¯¦ç»†çš„ mock
- æ€§èƒ½æµ‹è¯•åœ¨ Jest ç¯å¢ƒä¸­å¯èƒ½ä¸å¤Ÿå‡†ç¡®

### 3. åŠ¨ç”»å’Œè¿‡æ¸¡
- CSS åŠ¨ç”»å’Œè¿‡æ¸¡æ•ˆæœåœ¨æµ‹è¯•ç¯å¢ƒä¸­ä¸è¿è¡Œ
- éœ€è¦ä½¿ç”¨ `jest.useFakeTimers` å¤„ç†åŠ¨ç”»

---

## ä¸‹ä¸€æ­¥æ”¹è¿›è®¡åˆ’

### Phase 1: å¢åŠ æµ‹è¯•è¦†ç›–ç‡
- [ ] æ·»åŠ æ›´å¤šè¾¹ç•Œæƒ…å†µæµ‹è¯•
- [ ] å¢åŠ é›†æˆæµ‹è¯•åœºæ™¯
- [ ] è¡¥å……é”™è¯¯è·¯å¾„æµ‹è¯•

### Phase 2: æ€§èƒ½å’Œå¯è®¿é—®æ€§
- [ ] æ·»åŠ æ€§èƒ½åŸºå‡†æµ‹è¯•
- [ ] å¢å¼º ARIA æµ‹è¯•è¦†ç›–
- [ ] æ·»åŠ é”®ç›˜å¯¼èˆªå®Œæ•´æµ‹è¯•

### Phase 3: E2E æµ‹è¯•
- [ ] ä½¿ç”¨ Playwright ç¼–å†™ E2E æµ‹è¯•
- [ ] æµ‹è¯•å®Œæ•´çš„ç”¨æˆ·å·¥ä½œæµ
- [ ] æ·»åŠ è·¨æµè§ˆå™¨æµ‹è¯•

---

## æµ‹è¯•ç»´æŠ¤æŒ‡å—

### æ·»åŠ æ–°æµ‹è¯•

1. åœ¨ç›¸åº”çš„ `__tests__` ç›®å½•ä¸‹åˆ›å»ºæµ‹è¯•æ–‡ä»¶
2. ä½¿ç”¨æ ‡å‡†çš„æµ‹è¯•ç»“æ„ï¼š`describe` -> `test` -> `expect`
3. éµå¾ªå‘½åçº¦å®šï¼š`ComponentName.test.tsx`
4. ç¡®ä¿ mock æ‰€æœ‰å¤–éƒ¨ä¾èµ–

### æ›´æ–°ç°æœ‰æµ‹è¯•

1. ä¿®æ”¹ç»„ä»¶æ—¶åŒæ­¥æ›´æ–°æµ‹è¯•
2. è¿è¡Œ `npm test -- --watchAll=false` éªŒè¯æ‰€æœ‰æµ‹è¯•é€šè¿‡
3. æ£€æŸ¥è¦†ç›–ç‡æ˜¯å¦ä¸‹é™
4. æ›´æ–°æµ‹è¯•æ–‡æ¡£

### è°ƒè¯•å¤±è´¥çš„æµ‹è¯•

1. ä½¿ç”¨ `npm test -- --verbose` æŸ¥çœ‹è¯¦ç»†è¾“å‡º
2. ä½¿ç”¨ `test.only` ä¸“æ³¨äºå•ä¸ªæµ‹è¯•
3. æ£€æŸ¥ mock é…ç½®æ˜¯å¦æ­£ç¡®
4. éªŒè¯å¼‚æ­¥æ“ä½œæ˜¯å¦æ­£ç¡®å¤„ç†

---

## é™„å½•

### A. æµ‹è¯•å‘½ä»¤é€ŸæŸ¥

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# è¿è¡Œç‰¹å®šç»„ä»¶æµ‹è¯•
npm test -- VirtualFileBrowser

# ç›‘å¬æ¨¡å¼
npm test -- --watch

# è¦†ç›–ç‡æŠ¥å‘Š
npm test -- --coverage

# æ›´æ–°å¿«ç…§
npm test -- --updateSnapshot

# è°ƒè¯•æ¨¡å¼
npm test -- --detectOpenHandles
```

### B. ç›¸å…³æ–‡æ¡£

- [Jest å®˜æ–¹æ–‡æ¡£](https://jestjs.io/)
- [React Testing Library æ–‡æ¡£](https://testing-library.com/react)
- [Testing Best Practices](https://kentcdodds.com/blog/common-mistakes-with-react-testing-library)

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-01-24
**ç»´æŠ¤è€…**: QA Team
**ç‰ˆæœ¬**: 1.0.0
